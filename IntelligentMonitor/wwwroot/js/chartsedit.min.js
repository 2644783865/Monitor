function getCharts(){$.ajax({type:"get",url:"/api/Charts/get_charts",dataType:"json",async:!1,success:function(n){charts_data=n.data}})}function loadChartsHtml(){for(var t="",n=0;n<charts_data.length;n++)t+='<div data-id="'+charts_data[n].id+'" class="layui-col-md4 layui-col-md4 layui-col-md4 qix_'+charts_data[n].chartsId+'">',t+='<div class="layui-card">',t+='<div style="font-size:12px;line-height:22px;" class="layui-card-header layui-elip"><span>'+charts_data[n].chartsName+'<\/span><i title="删除此图表" class="layui-icon layui-icon-delete" onclick="deleteCharts(\''+charts_data[n].id+"','"+charts_data[n].chartsName+"','"+charts_data[n].chartsId+'\')" style="font-size: 20px;cursor:pointer;"><\/i><\/div>',t+='<div class="layui-card-body">',t+='<div class="layui-carousel charts" id="'+charts_data[n].chartsId+'"><\/div>',t+="<\/div>",t+="<\/div>",t+="<\/div>";for($(".layui-fluid .layui-row").html(t),n=0;n<charts_data.length;n++)charts.push("charts"+(n+1)),charts[n]=echarts.init(document.getElementById("charts"+(n+1)));$(".charts").css("height","250px");$(".charts>div").css("height","250px")}function reloadCharts(){disposeCharts();renderCharts()}function setTheme(){$.getJSON("/js/themes/"+theme+".json",function(n){disposeCharts();echarts.registerTheme(theme,n.theme);loading=n.loading;renderCharts()})}function addCookie(n,t){var i=new Date;i.setTime(i.getTime()+2592e6);document.cookie=n+"="+escape(t)+";expires="+i.toGMTString()}function getCookie(n){var t,i=new RegExp("(^| )"+n+"=([^;]*)(;|$)");return(t=document.cookie.match(i))?unescape(t[2]):null}function disposeCharts(){for(var n=0;n<charts.length;n++)charts[n].dispose()}function format(n){var t=new Date(n*1e3),e=t.getFullYear(),i=t.getMonth()+1,r=t.getDate(),u=t.getHours(),f=t.getMinutes(),o=t.getSeconds();return i+"/"+r+" "+u+":"+f}function renderCharts(){for(var t,i,n=0;n<charts_data.length;n++)charts[n]=echarts.init(document.getElementById("charts"+(n+1)),theme),charts[n].showLoading(loading),t="/api/Zabbix/history?itemids="+charts_data[n].itemId+"&time_from="+charts_data[n].timeForm+"&time_till="+charts_data[n].timeTill,i=charts_data[n].itemName,getChartsData(t,i,n)}var deleteCharts,getChartsData;getCookie(".AspNetCore.Tip")!="no"&&layui.use(["layer"],function(){var n=layui.layer,t=n.msg("请拖动图表进行排序，前台只展示前6个！",{time:5e3,btn:["知道了"],yes:function(){n.close(t);addCookie(".AspNetCore.Tip","no")}})});layui.use(["layer"],function(){var n=layui.layer;deleteCharts=function(t,i,r){n.confirm("确认删除此图表？",{title:i,btn:["确认","取消"]},function(){$.ajax({type:"post",url:"/api/Charts/delete_charts",contentType:"application/json; charset=utf-8",data:'"'+t+'"',success:function(t){t.code==0&&n.msg(t.msg,{icon:1,time:1e3},function(){$(".qix_"+r).remove()})}})},function(){n.close()})}});const refreshTime=6e4;let loading={},theme="shine",charts=[],charts_data=[];getCharts();loadChartsHtml();setTheme();setInterval(reloadCharts,refreshTime);$(".layui-fluid .layui-row").dad({draggable:".layui-card-header span",callback:function(){var n=[];$(".layui-fluid .layui-row .dads-children").each(function(){var t=$(this).data("id");n.push(t)});$.ajax({type:"post",url:"/api/Charts/update_charts",contentType:"application/json; charset=utf-8",data:'"'+n.join(",")+'"',success:function(n){console.log(n)}})}});window.addEventListener("resize",function(){for(var n=0;n<charts_data.length;n++)charts[n].resize()});getChartsData=function(n,t,i){$.getJSON(n,function(n){var r={backgroundColor:"#fff",tooltip:{trigger:"axis"},legend:{data:[t]},xAxis:{data:n.result.map(function(n){return format(n.clock)})},yAxis:{splitLine:{show:!1}},series:{name:t,type:"line",data:n.result.map(function(n){return n.value})}};charts[i].setOption(r);charts[i].hideLoading()})};
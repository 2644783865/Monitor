function getCharts(){$.ajax({type:"get",url:"/api/Charts/get_charts?count=6",dataType:"json",async:!1,success:function(n){charts_data=n.data}})}function loadChartsHtml(){for(var t="",n=0;n<charts_data.length;n++)t+='<div class="layui-col-md4 layui-col-md4 layui-col-md4">',t+='<div class="charts" id="'+charts_data[n].chartsId+'"><\/div>',t+="<\/div>";for($(".content .layui-row").html(t),n=0;n<charts_data.length;n++)charts.push("charts"+(n+1)),charts[n]=echarts.init(document.getElementById("charts"+(n+1)))}function resetChartsHeight(){$(".charts").css("height",$(".content").height()/2+"px");$(".charts>div").css("height",$(".content").height()/2+"px")}function getTime(){var n=new Date,o=n.getFullYear(),f=n.getMonth()+1,t,i,r,u,e;f=f<10?"0"+f:f;t=n.getDate();t=t<10?"0"+t:t;i=n.getHours();i=i<10?"0"+i:i;r=n.getMinutes();r=r<10?"0"+r:r;u=n.getSeconds();u=u<10?"0"+u:u;e=o+"-"+f+"-"+t+" "+i+":"+r+":"+u;$(".nav-bar span:eq(4)").html(e)}function addCookie(n,t){var i=new Date;i.setTime(i.getTime()+2592e6);document.cookie=n+"="+escape(t)+";expires="+i.toGMTString()}function getCookie(n){var t,i=new RegExp("(^| )"+n+"=([^;]*)(;|$)");return(t=document.cookie.match(i))?unescape(t[2]):null}function setTheme(){theme=getCookie(".AspNetCore.Theme")||"dark";theme!="dark"?$(".nav-header-brand img").attr("src","/imgs/logo_white.png"):$(".nav-header-brand img").attr("src","/imgs/logo_black.png");$.getJSON("js/themes/"+theme+".json",function(n){disposeCharts();echarts.registerTheme(theme,n.theme);loading=n.loading;const t=n.style;$("body").css({"background-image":t.backgroundImage,"background-color":t.backgroundColor});$(".nav").css("color",t.color);$(".nav-header-brand img").attr("src",t.logo);renderCharts(time_from,time_till)})}function disposeCharts(){for(var n=0;n<charts.length;n++)charts[n].dispose()}function reloadCharts(){disposeCharts();renderCharts(time_from,time_till)}function setThemeOptions(){$(".nav-menu").removeClass("layui-hide");var n="";$.getJSON("js/themes/themes.json",function(t){var i,r;for(i of t.themes){for(n+='<div class="layui-col-md12 layui-col-md12 layui-col-md12">',n+='<a class="theme-plan-group" title="'+i.name+'" style="background-color: '+i.background+';">',r=0;r<i.theme.length;r++)n+='<div class="theme-plan-color" style="background-color:'+i.theme[r]+' ;"><\/div>';n+="<\/a>";n+="<\/div>"}$(".theme>div").html(n)})}function setRangeOptions(){var n,i,t;$(".range-menu").removeClass("layui-hide");n="";i=[{name:"Last 5 minutes",range:"5|m"},{name:"Last 15 minutes",range:"15|m"},{name:"Last 30 minutes",range:"30|m"},{name:"Last 1 hours",range:"1|h"},{name:"Last 3 hours",range:"3|h"},{name:"Last 6 hours",range:"6|h"},{name:"Last 12 hours",range:"12|h"},{name:"Last 24 hours",range:"24|h"}];for(t of i)n+='<a href="javascript:;" data-range="'+t.range+'" class="layui-btn layui-btn-primary layui-btn-sm">'+t.name+"<\/a>";$(".ranges").html(n);$(".ranges a:eq(3)").addClass("range-hover")}function format(n){var s=new Date,o=new Date(n*1e3),u=o.getMonth()+1,t,i,r,f,e;return(u=u<10?"0"+u:u,t=o.getDate(),t=t<10?"0"+t:t,i=o.getHours(),i=i<10?"0"+i:i,r=o.getMinutes(),r=r<10?"0"+r:r,f=s.getMonth()+1,f=f<10?"0"+f:f,e=s.getDate(),e=e<10?""+e:e,u==f&&t==e)?i+":"+r:u+"/"+t+" "+i+":"+r}function renderCharts(n,t){for(var r,u,i=0;i<charts_data.length;i++)charts[i]=echarts.init(document.getElementById("charts"+(i+1)),theme),charts[i].showLoading(loading),n==""&&(n=charts_data[i].timeForm),t==""&&(t=charts_data[i].timeTill),r=charts_data[i].itemId.split(","),u=charts_data[i].itemName.split(","),getChartsData(r,u,i)}var time_from="",time_till="",getChartsData;layui.use(["laydate"],function(){function t(n){var t=new Date,i=n.split("|");i[1]=="m"?(t.setMinutes(t.getMinutes()-i[0]),time_from=t.format(),time_till=(new Date).format()):i[1]=="h"?(t.setHours(t.getHours()-i[0]),time_from=t.format(),time_till=(new Date).format()):(time_from="",time_till="")}var n=layui.laydate;n.render({elem:"#range",type:"datetime",range:!0,done:function(n){if($(".ranges a").removeClass("range-hover"),n.length>0){var t=n.split(" - ");time_from=t[0];time_till=t[1]}else time_from="",time_till="",$(".ranges a:eq(3)").addClass("range-hover");renderCharts(time_from,time_till);range_menu.close()}});$(".ranges a").click(function(){$(".ranges a").removeClass("range-hover");$(this).addClass("range-hover");var n=$(this).data("range");t(n);renderCharts(time_from,time_till);range_menu.close()})});Date.prototype.format=function(){var n="yyyy-MM-dd hh:mm:ss",i={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},t;/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(t in i)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length==1?i[t]:("00"+i[t]).substr((""+i[t]).length)));return n};const refreshTime=6e4,nav_menu=new mSlider({dom:".nav-menu",direction:"right",distance:"20%"}),range_menu=new mSlider({dom:".range-menu",direction:"top",distance:"100px"});let loading={},theme="",charts=[],charts_data=[];getCharts();loadChartsHtml();resetChartsHeight();setTheme();setThemeOptions();setRangeOptions();setInterval(getTime,1e3);setInterval(reloadCharts,refreshTime);$(".nav-bar span:eq(0)").click(function(){range_menu.open()});$(".nav-bar span:eq(1)").click(function(){nav_menu.open()});window.addEventListener("resize",function(){resetChartsHeight();for(var n=0;n<charts_data.length;n++)charts[n].resize()});$(".theme").on("click","a",function(){let n=$(this).attr("title");if(n==getCookie(".AspNetCore.Theme"))return!1;addCookie(".AspNetCore.Theme",n);setTheme()});$(".nav-bar span:eq(2)").click(function(){var n=document.documentElement,i="layui-icon-screen-full",u="layui-icon-screen-restore",r=$(this).children("i"),t;r.hasClass(i)?(t=n.requestFullScreen||n.webkitRequestFullScreen||n.mozRequestFullScreen||n.msRequestFullscreen,typeof t!="undefined"&&t&&t.call(n),r.addClass(u).removeClass(i),$(".nav-bar span:eq(2)").attr("title","退出全屏")):(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),r.addClass(i).removeClass(u),$(".nav-bar span:eq(2)").attr("title","全屏"))});getChartsData=function(n,t,i){for(var r="/api/Zabbix/history?",u=0;u<n.length;u++)r+="&itemids="+n[u];r+="&time_from="+time_from;r+="&time_till="+time_till;$.getJSON(r,function(r){for(var f,e,s,h,o=[],c=r.result,u=0;u<n.length;u++)f=[],e=[],c.map(function(t){t.itemid==n[u]&&(e.push(t.value),f.push(format(t.clock)))}),s={name:t[u],type:"line",data:e},o.push(s);h={title:{text:charts_data[i].chartsName,left:"center",textStyle:{fontSize:16}},tooltip:{trigger:"axis"},legend:{},grid:{left:"3%",right:"3%",bottom:"5%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:f},yAxis:{splitLine:{show:!0},type:"log"},series:o};charts[i].setOption(h);charts[i].hideLoading()})};
function getCharts(){$.ajax({type:"get",url:"/api/Charts/get_charts?count=6",dataType:"json",async:!1,success:function(n){charts_data=n.data}})}function loadChartsHtml(){for(var t="",n=0;n<charts_data.length;n++)t+='<div class="layui-col-md4 layui-col-md4 layui-col-md4">',t+='<div class="charts" id="'+charts_data[n].chartsId+'"><\/div>',t+="<\/div>";for($(".content .layui-row").html(t),n=0;n<charts_data.length;n++)charts.push("charts"+(n+1)),charts[n]=echarts.init(document.getElementById("charts"+(n+1)))}function resetChartsHeight(){$(".charts").css("height",$(".content").height()/2+"px");$(".charts>div").css("height",$(".content").height()/2+"px")}function getTime(){var n=new Date,o=n.getFullYear(),f=n.getMonth()+1,t,i,r,u,e;f=f<10?"0"+f:f;t=n.getDate();t=t<10?"0"+t:t;i=n.getHours();i=i<10?"0"+i:i;r=n.getMinutes();r=r<10?"0"+r:r;u=n.getSeconds();u=u<10?"0"+u:u;e=o+"-"+f+"-"+t+" "+i+":"+r+":"+u;$(".nav-time span:eq(3)").html("当前时间："+e)}function addCookie(n,t){var i=new Date;i.setTime(i.getTime()+2592e6);document.cookie=n+"="+escape(t)+";expires="+i.toGMTString()}function getCookie(n){var t,i=new RegExp("(^| )"+n+"=([^;]*)(;|$)");return(t=document.cookie.match(i))?unescape(t[2]):null}function setTheme(){theme=getCookie(".AspNetCore.Theme")||"dark";theme!="dark"?$(".nav-header-brand img").attr("src","/imgs/logo_white.png"):$(".nav-header-brand img").attr("src","/imgs/logo_black.png");$.getJSON("js/themes/"+theme+".json",function(n){disposeCharts();echarts.registerTheme(theme,n.theme);loading=n.loading;const t=n.style;$("body").css({"background-image":t.backgroundImage,"background-color":t.backgroundColor});$(".nav").css("color",t.color);$(".nav-header-brand img").attr("src",t.logo);renderCharts()})}function disposeCharts(){for(var n=0;n<charts.length;n++)charts[n].dispose()}function reloadCharts(){disposeCharts();renderCharts()}function setThemeOptions(){$(".nav-menu").removeClass("layui-hide");var n="";$.getJSON("js/themes/themes.json",function(t){var i,r;for(i of t.themes){for(n+='<div class="layui-col-md12 layui-col-md12 layui-col-md12">',n+='<a class="theme-plan-group" title="'+i.name+'" style="background-color: '+i.background+';">',r=0;r<i.theme.length;r++)n+='<div class="theme-plan-color" style="background-color:'+i.theme[r]+' ;"><\/div>';n+="<\/a>";n+="<\/div>"}$(".theme>div").html(n)})}function format(n){var t=new Date(n*1e3),e=t.getFullYear(),i=t.getMonth()+1,r=t.getDate(),u=t.getHours(),f=t.getMinutes(),o=t.getSeconds();return i+"/"+r+" "+u+":"+f}function renderCharts(){for(var t,i,n=0;n<charts_data.length;n++)charts[n]=echarts.init(document.getElementById("charts"+(n+1)),theme),charts[n].showLoading(loading),t="/api/Zabbix/history?itemids="+charts_data[n].itemId+"&time_from="+charts_data[n].timeForm+"&time_till="+charts_data[n].timeTill,i=charts_data[n].itemName,getChartsData(t,i,n)}const refreshTime=6e4,_menu=new mSlider({dom:".nav-menu",direction:"right",distance:"20%"});let loading={},theme="",charts=[],charts_data=[];getCharts();loadChartsHtml();resetChartsHeight();setTheme();setThemeOptions();setInterval(getTime,1e3);setInterval(reloadCharts,refreshTime);$(".nav-time span:eq(0)").click(function(){_menu.open()});window.addEventListener("resize",function(){resetChartsHeight();for(var n=0;n<charts_data.length;n++)charts[n].resize()});$(".theme").on("click","a",function(){let n=$(this).attr("title");if(n==getCookie(".AspNetCore.Theme"))return!1;addCookie(".AspNetCore.Theme",n);setTheme()});$(".nav-time span:eq(1)").click(function(){var n=document.documentElement,i="layui-icon-screen-full",u="layui-icon-screen-restore",r=$(this).children("i"),t;r.hasClass(i)?(t=n.requestFullScreen||n.webkitRequestFullScreen||n.mozRequestFullScreen||n.msRequestFullscreen,typeof t!="undefined"&&t&&t.call(n),r.addClass(u).removeClass(i),$(".nav-time span:eq(1)").attr("title","退出全屏")):(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),r.addClass(i).removeClass(u),$(".nav-time span:eq(1)").attr("title","全屏"))});var getChartsData=function(n,t,i){$.getJSON(n,function(n){var r={tooltip:{trigger:"axis"},legend:{data:[t]},xAxis:{data:n.result.map(function(n){return format(n.clock)})},yAxis:{splitLine:{show:!1}},series:{name:t,type:"line",data:n.result.map(function(n){return n.value})}};charts[i].setOption(r);charts[i].hideLoading()})};